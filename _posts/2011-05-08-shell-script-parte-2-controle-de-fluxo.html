---
layout: post
title: Shell Script - Parte 2 - Controle de Fluxo
categories:
- Aulas
- Blog
- Shell Script
tags:
- Aulas
- Bash
- shell script
status: publish
type: post
published: true
meta:
  _edit_last: '1'
---
[ad#propaganda]
<p style="text-align: left;">Esta é a segunda parte das aulas de <strong>shell script</strong>. <a href="http://evaldojunior.com.br/blog/?p=1022" title="Shell Script – Parte 1 – Introdução">A primeira parte pode ser lida aqui</a>. Essas aulas são focadas na sintaxe do <strong>Bash</strong>, então nem tudo pode funcionar da mesma maneira no sh, ksh...</p>
<p style="text-align: left;">E vamos ao que interessa, mais sobre <strong>shell script</strong>:</p>

<h2>Tomada de Decisões</h2>
Em toda linguagem de programação existe alguma estrutura para tomada de decisões. Essa estrutura em geral é feita através do comando "<strong>if</strong>". O comando "<strong>if</strong>" analisa de uma expressão é verdadeira e então executa um bloco de código, caso a expressão seja falsa pode ser executado, ou não, um outro bloco.

Em geral as linguagens de programação oferecem maneiras de verificar se um valor é igual, menor ou maior que outro. As formas mais comuns são:
<ul>
	<li><strong>==</strong> : Igual à</li>
	<li><strong>!=</strong> : Diferente de</li>
	<li><strong>&lt;</strong> : Menor que</li>
	<li><strong>&gt;</strong> : Maior que</li>
	<li><strong>&lt;=</strong> : Menor ou igual à</li>
	<li><strong>&gt;=</strong> : Maior ou igual à</li>
</ul>
Em shell script os mesmos testes são obtidos com:
<ul>
	<li><strong>-eq</strong> : (equal) Igual à</li>
	<li><strong>-ne</strong> : (not equal) Diferente de</li>
	<li><strong>-lt</strong> : (less than) Menor que</li>
	<li><strong>-gt</strong> : (greater than) Maior que</li>
	<li><strong>-le</strong> : (less or egual) Menor ou igual à</li>
	<li><strong>-ge</strong> : (greater or equal) Maior ou igual à</li>
</ul>
O uso do "<strong>if</strong>" em shell script é assim:

<code bash>
#!/bin/bash
if [ 2 -eq 4 ]
then
    echo "Esse echo nunca acontecerá"
fi
</code>

Repare que é necessário manter <strong>espaços</strong> entre os colchetes e os números, ou variáveis. O bloco após a palavra "<strong>then</strong>" será executado se a expressão dentro do "<strong>if</strong>" for verdadeira. O bloco "<strong>if</strong>" termina com a palavra "<strong>fi</strong>" que é "<strong>if</strong>" ao contrário. Essa é uma maneira simples de identificar o final de um "<strong>if</strong>" quando o encontramos.

As expressões acima são mais comuns para tratar números. Para fazer comparações com textos use:
<ul>
	<li><strong>=</strong> : Igual à (isso mesmo apenas um sinal de igual)</li>
	<li><strong>!=</strong> : Diferente de</li>
	<li><strong>-n</strong> : String existe e não é vazia (apenas um operador)</li>
	<li><strong>-z </strong>: String existe e é vazia (apenas um operador)</li>
</ul>
Veja um exemplo com Strings:

<code bash>
#!/bin/bash
echo "Digite seu nome: "
read nome
if [ -z $nome ]
then
    echo "Você não digitou seu nome!"
else
    echo "Olá, $nome"
fi
</code>

No script acima o "<strong>if</strong>" verifica se a variável <strong>$nome</strong> existe e está vazia, isso significa que o usuário não digitou o nome dele. A instrução "<strong>read</strong>" faz com que o shell leia alguma informação via teclado e retorne essa informação para a variável informada.

Também no script acima foi usada a palavra "<strong>else</strong>" que significa "<strong>senão</strong>". Esse bloco é executado quando o "<strong>if</strong>" retorna um valor falso.
<h2>O Super IF do Shell</h2>
Mas o shell oferece mais opções para o "<strong>if</strong>" do que as linguagens de programação o fazem! Veja outras opções bem interessantes:
<ul>
	<li><strong>-s </strong>: Arquivo existe, não vazio (apenas um operador)</li>
	<li><strong>-f </strong>: Arquivo existe, não é um diretório (apenas um operador)</li>
	<li><strong>-d </strong>: Diretório existe (apenas um operador)</li>
	<li><strong>-w </strong>: Arquivo, com permissão de escrita (apenas um operador)</li>
	<li><strong>-r</strong> : Arquivo, com permissão de leitura (apenas um operador)</li>
	<li><strong>-x </strong>: Arquivo, com parmissão de execução  -x  (apenas um operador)</li>
</ul>
Veja um exemplo:

<code bash>
#!/bin/bash
arquivo="/tmp/meuLog.txt"
if [ -f "$arquivo" ]
then
    echo "Continuando log..." >> "$arquivo"
else
    echo "Criando log..." > "$arquivo"
fi
</code>

O script acima verifica se o arquivo "<strong>/tmp/meuLog.txt</strong>" existe. Caso exista ele continua o arquivo, colocando mais informações no final dele (redirecionador <strong>&gt;&gt;</strong>). Caso o arquivo não exista ele o inicia (com o redirecionador <strong>&gt;</strong>).
<h2>IFs Aninhados</h2>
Chamamos de "<strong>ifs aninhados</strong>" as construções onde há um "<strong>if</strong>" dentro do bloco "<strong>then</strong>" ou "<strong>else</strong>" de outro "<strong>if</strong>":

<code bash>
#!/bin/bash
echo "Digite seu nome: "
read nome
echo "Digite sua idade: "
read idade
if [ -z $nome ]
then
    echo "Você não digitou seu nome."
else
    echo "Seu nome é $nome"
    if [ $idade -gt 10 ]
    then
        echo "Você tem mais que 10 anos."
    else
        echo "Você tem 10 anos ou menos."
    fi
fi
</code>

<h2>IF Multilevel</h2>
Você pode fazer comparações em sequência, com o uso do "<strong>elif</strong>", desse jeito:

<code bash>
#!/bin/bash
echo "Digite um número"
read numero
if [ $numero -gt 0 ];
then
    echo "Número positivo"
elif [ $numero -lt 0 ]
then
    echo "Número negativo"
elif [ $numero -eq 0 ]
then
    echo "Número é zero"
else
    echo "O valor fornecido não é um número!"
fi
</code>

Além do comando "<strong>if</strong>", o shell oferece opções como "<strong>case</strong>" para controle de fluxo.
<h2>O Comando Case</h2>
O comando "<strong>case</strong>" é usado para executar um bloco de código de acordo com o valor de uma variável. O comando "<strong>case</strong>" é interessante pois pode definir diversas opções diferentes sem usar uma estrutura com diversos comandos "<strong>if</strong>", "<strong>elif</strong>" e "<strong>else</strong>". Veja um exemplo:

<code bash>
#!/bin/bash
echo -n "O que deseja fazer? (A)lmoçar/(J)antar/(S)air? [A] "
read resposta
case "$resposta" in
    a|A|"")
        echo "Então tenha um bom almoço =)"
    ;;
    j|J)
        echo "Um jantar vai muito bem."
    ;;
    s|S)
        echo "Saindo..."
    ;;
    *)
        echo "Opção inválida"
    ;;
esac
</code>

O script acima exibe uma mensagem e então pede uma informação do usuário. O usuário vai digitar alguma letra e então o comando "case" entra em ação. Ele verifica qual valor foi digitado pelo usuário e executa os blocos de código relativos a cada opção. Primeira opção é a padrão, por isso ela é executada mesmo que o usuário não digite um valor.Cada bloco do case é iniciado por um valor que a variável analisada pode ter, ou vários valores, separados por um pipe. Os blocos são finalizados por uma sequência de dois caracteres 'ponto-e-vírgula' (;;).

<h2>Conclusão</h2>

A estrutura de controle "<strong>if</strong>" do shell é bem interessante pois permite fazer diversas comparações entre valores e ainda oferece opções para lidar com o sistema de arquivos. O comando "<strong>case</strong>" pode tratar diversos valores de uma vez, o que acuda a manter o código mais limpo e organizado.

Até a próxima!
